version: "3.8"

services:
  # 1. App Go
  api_server:
    build: .
    container_name: go_api_container
    ports:
      - "${APP_PORT:-8080}:8080" # L·∫•y port t·ª´ .env, n·∫øu ko c√≥ th√¨ m·∫∑c ƒë·ªãnh 8080
    depends_on:
      - db_postgres
    environment:
      # üëá App Go s·∫Ω ƒë·ªçc m·∫•y bi·∫øn n√†y ƒë·ªÉ t·∫°o DSN
      # L∆∞u √Ω: Host ph·∫£i l√† t√™n service b√™n d∆∞·ªõi (db_postgres), KH√îNG ph·∫£i localhost
      - DB_HOST=db_postgres
      - DB_PORT=${DB_PORT}
      - DB_USER=${DB_USER}
      - DB_PASSWORD=${DB_PASSWORD}
      - DB_NAME=${DB_NAME}
      - TZ=${DB_TIMEZONE} # Set m√∫i gi·ªù cho Container App
    networks:
      - my_network

  # 2. Database Postgres
  db_postgres:
    image: postgres:15-alpine
    container_name: postgres_db_container
    environment:
      # üëá Postgres d√πng bi·∫øn ri√™ng c·ªßa n√≥, m√¨nh map gi√° tr·ªã t·ª´ .env v√†o
      - POSTGRES_USER=${DB_USER}
      - POSTGRES_PASSWORD=${DB_PASSWORD}
      - POSTGRES_DB=${DB_NAME}
      - TZ=${DB_TIMEZONE} # Set m√∫i gi·ªù cho DB (Quan tr·ªçng ƒë·ªÉ l∆∞u gi·ªù VN)
    ports:
      - "${DB_PORT}:5432" # Map c·ªïng 5432 ra ngo√†i ƒë·ªÉ √¥ng d√πng DBeaver
    volumes:
      - pg_data:/var/lib/postgresql/data
    networks:
      - my_network

networks:
  my_network:
    driver: bridge

volumes:
  pg_data:
